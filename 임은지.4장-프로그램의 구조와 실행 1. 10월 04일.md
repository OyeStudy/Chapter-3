# 컴퓨터 시스템의 동작 원리-2
## 6. DMA (Direct Memory Access)
### _DMA_

	원칙적으로 메모리는 CPU에 의해서만 접근할 수 있는 장치
일종의 컨트롤러로서 CPU가 입출력 장치들의 메모리 접근 요청에 의해 자주 인터럽트 당하는 것을 막아주는 역할을 한다.

`DMA`를 사용하게 되면 로컬버퍼에서 메모리로 읽어오는 작업을 CPU가 아닌 DMA가 대행함으로써 CPU는 인터럽트를 처리할 필요가 없어지는 것이다. 이때 DMA는 바이트(byte)단위가 아니라 블록(block)이라는 큰 단위로 정보로 읽어오는 방식으로 CPU에 발생하는 인터럽트의 빈도를 줄여 CPU를 좀 더 효율적으로 관리할 수 있다.

***

## 7. 저장장치의 구조
### 주기억장치

	보통 메모리라고 부르며 전원이 나가면 새로 저장되었던 내용이 모두 사라져버리는 휘발성(volatile)의 RAM을 매체로 사용하는 경우가 많다.

### 보조기억장치

	주기억장치와 다르게 전원이 나가도 저장된 내용을 기억할 수 있는 비휘발성(nonvolatile)의 마그네틱 디스크를 주로 사용한다.


### 보조기억장치의 용도
#### 1. 파일 시스템(file system)용


	전원이 나가도 유지해야 할 정보가 있으면 그것을 파일 형태로 보조기억장치에 저장

#### 2. 스왑 영역(swap area)용


	· 프로그램이 실행될 때 내용을 저장했다가 프로그램이 종료될 때 삭제하는 메모리의 연장 공간으로서의 역할
    · 크기가 한정되며
    · 상대적으로 가격은 비싸고 용량은 작은 경우가 대부분
    
다수의 프로그램이 메모리에 올라가 동시 수행되는 경우 메모리 공간이 부족한 경우가 흔히 발생하게 되는데 이 경우 프로그램 수행에 당장 필요한 부분만 메모리에 올려놓고 외의 것은 디스크 스왑 영역에 내려놓게 된다. 이처럼 디스크에 내려놓는 일을 `스왑 아웃(swap out)` 시킨다고 말하며 스왑 아웃된 부분이 필요할 때에는 다시 메모리 영역으로 올리게 된다.

#### 하드디스크의 물리적 구조
![하드디스크의 물리적 구조](https://velog.velcdn.com/images/zzallang/post/875d1375-38f1-4514-a5d3-36f978e29e05/image.jpg)
보조기억장치의 대표적인 하드디스크에는 여러 개의 마그네틱 원판이 있고,`암(arm)`이 이동하며 원판에 저장된 데이터를 읽고 쓰는 방식으로 동작하며 디스크 원판의 표면은 `트랙(track)`으로 나뉘고, 각 트랙은 `섹터(secor)`로 나뉜다. 섹터에 최소한의 단위 정보가 저장됨.
***
## 8.저장장치의 계층 구조
![컴퓨터 시스템의 저장장치 계층 구조](https://velog.velcdn.com/images/zzallang/post/7932f42e-c78e-4fcd-be48-ec154ee0c280/image.png)
컴퓨터 시스템을 구성하는 저장장치는 빠른 저장장치부터 느린 저장장치까지 단계적인 계층 구조로 이루어진다.(그림 참조)

최상위는 CPU 내부에 존재하는 레지스터(register), 캐시 메모리(cache memory), 메인 메모리(main memory)등의 `휘발성 저장장치`로 구성되는 부분이 상위에 존재하며 전원이 나가도 지워지지 않는 `비휘발성 장치`는 하위에 존재한다. 


#### 캐싱기법
	상대적으로 느린 저장장치에 있는 내용 중 당장 사용되거나 빈번히 사용될 정보를 빠른 저장장치에 선별적으로 저장함으로써
    두 저장장치 사이의 속도를 완충 시키는 기법이며
    이 기법을 활용함으로써 적은 용량의 상위 저장장치만으로도 대부분의 경우 바로 수행 속도를 낼 수 있다.

***
## 9.하드웨어의 보안
흔히 사용하는 OS는 다중 프로그래밍(multi-programing) 환경에서 동작한다. 각 프로그램이 다른 프로그램의 실행을 방해하거나 충돌을 일으키는 문제를 막기 위해 OS는 기본적으로 `커널모드`와 `사용자모드` 두 가지 모드를 지원한다.

### 커널모드(kernel mode, system mode)
	OS가 CPU의 제어권을 가지고 OS 코드를 통해 실행하는 모드
    모든 종류의 명령 수행
    특히, 모든 입출력 명령은 특권 명령으로 규정하여 커널모드에서만 수행
### 사용자모드(user mode)
	일반 사용자 프로그램이 실행하는 모드
    제한적인 명령만 수행
    
### 모드비트(mode bit)
	사용자 프로그램을 감시하는 용도로 CPU 내부에 모드비트를 두어 감시하며
    CPU는 보안과 관련된 명령을 수행하기 전에는 항상 모드비트를 조사해 값이 0으로 세팅된 경우에만 명령을 수행
    
-  모드비트가 0인 경우
	1. 커널모드로서 모든 명령을 수행
 	2. 인터럽트가 발생할 때 자동으로 0으로 세팅
  	3. 특권 명령인 경우

-  모드비트가 1인 경우
	1. 사용자모드로서 제한된 명령을 수행
	2. 인터럽트 작업이 끝난 후 자동으로 1로 세팅
    
***
## 10. 메모리보안
디스크뿐 아니라 메모리의 경우에도 보안이 필요한데 이는 여러 프로그램이 메모리에 동시에 올라가서 실행되기 때문에 적어도 `인터럽트 벡터`와 `인터럽트 처리루틴`이 있는 곳은 각별한 보안이 필요하다.
이 문제를 해결하기 위해 `기준 레지스터`와 `한계 레지스터`, 두 개의 레지스터를 사용해서 메모리를 보호할 수 있다.
### 기준 레지스터(base register)
	어떤 프로그램이 수행되는 동안 그 프로그램이 합법적으로 접근할 수 잇는 메모리상의 가장 작은 주소를 보관
### 한계 레지스터(limit register)
	그 프로그램이 기준 레지스터값부터 접근할 수 있는 메모리의 범위를 보관

`사용자 프로그램`은 기준 레지스터에 있는 주소부터 기준 레지스터+한계 레지스터값 사이의 주소만 접근 가능하며 범위 밖이라면 예외상황이라는 인터럽트를 발생시켜 프로그램을 강제 종료시킨다.

`사용자모드`인 경우 두 개의 레지스터를 사용해서 메모리를 보호하며 `커널모드`에서는 메모리에 무제한으로 접근하는 것이 가능하다. 메모리의 접근 명령은 특권명령은 아니지만 메모리를 보호하기 위해서는 두 개의 레지스터 값을 세팅하는 연산은 특권 명령으로 규정해야 한다.

***
## 11. CPU 보호
### 타이머(timer)
	CPU가 하나의 프로그램에 의해 독점되는 것을 막기 위해 사용하는 하드웨어
    타이머는 정해진 시간이 지나면 인터럽트를 발생시켜 OS가 CPU의 제어권을 획득할 수 있도록 하는 역할을 수행
타이머는 일정한 시간 단위로 세팅할 수 있으며 매 `클럭 틱(clock tick)`때 마다 1씩 감소하며 0이되는 순간 인터럽트를 발생시킨다. 여기서 타이머의 값을 세팅하는 명령을 `로드 타이머(load timer)`라고 하며, 특권명령에 속한다.
***
## 12. 시스템 콜을 이용한 입출력 수행
사용자 프로그램이 하는 입출력 행위는 특권명령인 입출력 명령에 해당하므로 사용자 프로그램이 직접 수행할 수 없는 대신 OS에게 `시스템 콜`이라는 서비스 대행 요청으로 입출력을 수행한다
### 시스템 콜
	일종의 소프트웨어적인 인터럽트
    
시스템 콜을 할 경우 트랩이 발생해 CPU의 제어권이 OS로 넘어가게 되면 OS는 해당 시스템 콜을 처리하기 위한 루틴으로 가서 정의된 명령을 수행 후 CPU에게 입출력이 완료되었음을 알려줌으로써 해당 프로그램이 다시 CPU를 할당받을 수 있도록 한다.



